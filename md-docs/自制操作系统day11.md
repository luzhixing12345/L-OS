


# day11 制作窗口

## 绘图与窗口

对于画面外的支持就是简单的处理一下`sheet_refreshsub`这个函数,将显示的范围和(0 0 ct1->xsize ct1->ysize)比较,进行约束

然后就是调整一下函数的结构,参数之类的,这里传参调整一下就可以了.

![20220708130959](https://raw.githubusercontent.com/learner-lu/picbed/master/20220708130959.png)

然后是绘制一个窗口,就是调用了之前的一些函数,这一部分也没什么特别好说的

![20220711171656](https://raw.githubusercontent.com/learner-lu/picbed/master/20220711171656.png)

然后一个计数器,疯狂刷新闪屏.闪屏的原因作者也做了解释,就是绘图是根据图层高度从下向上刷新,先绘制最底层的,然后依次向上.所以先把底层的蓝绿色绘制出来,然后绘制了计数器的哪一行.所以看起来一直在花

> 这个计数器的实现我以为很专业,定睛一看就是for循环一直count++,跟时间其实都没关系

![wes](https://raw.githubusercontent.com/learner-lu/picbed/master/wes.gif)

## 消除闪烁

思路很清晰,我来总结一下

我们只刷新变化的窗口及其之上的所有图层,新建一个map指针用于描述页面中各个点属于的图层,这样当某一个图层被刷新时,我们只需要刷新这个图层的范围(X,Y)大小内,所有露出来的部分,被遮挡(SID不属于当前图层)的部分同样不需要刷新


这里我有一个想法,既然是指定图层的点的区域,为什么不从上向下刷新呢?既然现在的问题是从下向上刷新会导致重复闪烁,那从上向下绘图,只绘制第一个不就可以了么,如果是透明那么就接下来继续绘制下一个高度的


{% note warning %}
注 : 我不太清楚是什么原因,如果你长时间运行这个程序计数器的话过一段时间会直接异常退出,报错`make.exe[1]: *** [default] Error -1073741819`,我也不太清楚什么情况...

我运行了下源文件也有这个状况,估计是内存交换没做好吧,不太懂为什么
